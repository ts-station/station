<!doctype html>
<html lang="en" style="font-size: 100px">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>班次查询结果</title>
    <link rel="stylesheet" href="__PUBLIC__/Home/css/common1.css">
    <link rel="stylesheet" href="__PUBLIC__/Home/less/demand.css">
</head>
<body>
    <div class="header">
        <a href="#" onClick="javascript:history.back(-1);">&lt;</a>
        <div class="banxin header-t">
            <div>
                <p>泸州-成都</p>
            </div>
        </div>
        <div class="banxin header-b">
            <button class="fl" onclick="one_date(0)">前一天</button><button><span></span>{$time}<span></span></button><button class="fr"  onclick="one_date(1)">后一天</button>
        </div>
    </div>

    <form action="result_search" method="post">
        <input type="text" name="time" value="{$time}" style="display: none" id="time">
        <input type="text" name="begin" value="{$begin}" style="display: none" id="begin">
        <input type="text" name="end" value="{$end}" style="display: none" id="end">
        <input type="submit" value="查 询" style="display: none" id="search-submit">
    </form>


    <div class="cont">
        <ul class="have">
            <volist name="data" id="f">
                <if condition="$f['leave_seats']">
                    <li runsid="{$f['runsid']}" runsdate="{$f['runsdate']}" class="ticket-add have-color">
                        <div class="banxin">
                            <div>{$f['time']}</div>
                            <div>
                                <div>
                                    <span></span>
                                    <span>{$f['begin']}</span>

                                </div>
                                <div>
                                    <span></span>
                                    <span>{$f['busmodel']}</span>
                                </div>
                            </div>
                            <div>
                                <span>{$f['leave_seats']}张</span>
                                <span></span>
                                <span>固定班267</span>
                                <span>携童3张</span>
                            </div>
                            <div>
                                <div>
                                    <span></span>
                                    <span>{$f['end']}</span>
                                </div>
                                <div>
                                    <span>¥</span>
                                    <span>{$f['price']}</span>
                                </div>
                            </div>
                        </div>
                    </li>

                </if>
            </volist>

        <!--</ul>
        <ul class="none">-->
            <volist name="data" id="f">
                <if condition="!$f['leave_seats']">
                    <li class="none-color">
                        <div class="banxin">
                            <div>{$f['time']}</div>
                            <div>
                                <div>
                                    <span></span>
                                    <span>{$f['begin']}</span>

                                </div>
                                <div>
                                    <span></span>
                                    <span>{$f['busmodel']}</span>
                                </div>
                            </div>
                            <div>
                                <span>已售完</span>
                                <span></span>
                                <span>固定班267</span>
                                <span>携童3张</span>
                            </div>
                            <div>
                                <div>
                                    <span></span>
                                    <span>{$f['end']}</span>
                                </div>
                                <div>
                                    <span>¥</span>
                                    <span>{$f['price']}</span>
                                </div>
                            </div>
                        </div>
                    </li>
                </if>
            </volist>
            <!--<li>
                <div class="banxin">
                    <div>07:00</div>
                    <div>
                        <div>
                            <span></span>
                            <span>泸州南</span>

                        </div>
                        <div>
                            <span></span>
                            <span>大型高一</span>
                        </div>
                    </div>
                    <div>
                        <span>已售完</span>
                        <span></span>
                        <span>固定班267</span>
                    </div>
                    <div>
                        <div>
                            <span></span>
                            <span>成都北</span>
                        </div>
                        <div>
                            <span>¥</span>
                            <span>290</span>
                        </div>
                    </div>
                </div>
            </li>-->
        </ul>
    </div>
    <div class="but">
        <button class="fl">
            <span></span>
            <span>发车</span>
        </button><button class="fr">
            <span></span>
            <span>票价</span>
    </button>
    </div>
</body>
<script src="__PUBLIC__/Home/js/common.js">
</script><script src="__PUBLIC__/Home/js/jquery.js"></script>
<script>

    $(document).ready(function(){
        $("#button1").click(function(){
            $("#list-type").val(0);
            $("#search-submit").click();
        });
        $("#button2").click(function(){
            $("#list-type").val(1);
            $("#search-submit").click();
        });
        $(".ticket-add").click(function(){
            var runsid=$(this).attr('runsid');
            var runsdate=$(this).attr('runsdate');
            window.location.href="../order/edit_order?runsid="+encodeURIComponent(runsid)+"&runsdate="+runsdate;
        });
        $('.but button').click(function(){
            alert($(this).attr('class'));
        });
        $('#yesterday').click(function(){
            alert(date);
            //var date = $('#time').val();var date = new Date("{$time}");
            date = date.valueOf();
            var date = date - 24 * 60 * 60 * 1000;
            alert(date);

            var date = new Date(date);
            date =date.getFullYear()+"-" + (date.getMonth()+1) + "-" + date.getDate();
            console.log(date);
            $('#time').val(date);
        });

    });
    var load_flag=false;
    $(function(){
        $(window).scroll(function(){
            if(load_flag){
                return;
            }
            var totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop());
            if(totalheight>=$(document).height()){
                $("#loadmore").show();
                load_flag=true;
                loadMore();
            }
        });
    });
    function loadMore(){
        var list = new Array();
        var obj = {
            "time":$('#time').attr('value'),
            "begin":$('#begin').attr('value'),
            "end":$('#end').attr('value'),
        };
        $.ajax({
            type:'post',
            url:"ajax_search",
            data:obj,
            dataType:'json',
            success:function(result){
                console.log(result);
                $.each( result, function(i , n){
                    console.log(n );
                    var str= ' <li class="none-color"><div class="banxin"><div>'+ n.time +'</div><div> <div><span>' +
                            '</span><span> '+ n.begin +' </span></div><div><span></span><span> '+ n.busmodel +' </span></div>' +
                            '</div><div><span>已售完</span><span></span><span>固定班267</span><span>携童3张</span></div>' +
                            '<div><div><span></span><span>  '+ n.end +' </span></div><div><span>¥</span><span>'+ n.time +
                            '</span></div></div></div></li>';
                    $('.have').append(str);
                });
            }
        });


        /*$.ajax({
            type: "post",
            url: "http://127.0.0.1/station/home/search/ajax_search",
            // data sent is json
            contentType: "application/json; charset=utf-8",
            // Post 方式，data参数不能为空""，
            //如果不传参数，也要写成"{}"，否则contentType将不能附加在Request Headers中。
            data: "time="+2222,
            // data in response will expected json
            dataType: "json",
            anysc: false,
            success: function (result) {
                console.log( result );
                console.log(123);
                $.each( result, function(i, n){
                    console.log( n );
                   var str= ' <li class="none-color"><div class="banxin"><div>'+ n.time +'</div><div> <div><span>' +
                    '</span><span> n.time </span></div><div><span></span><span> n.time </span></div>' +
                    '</div><div><span>已售完</span><span></span><span>固定班267</span><span>携童3张</span></div>' +
                    '<div><div><span></span><span> n.time </span></div><div><span>¥</span><span>'+ n.time +
                    '</span></div></div></div></li>';
                    $('.have').append(str);
                });
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert(errorThrown + ':' + textStatus); // 错误处理
            }
        });*/
    }
    var time = "{$time}";
    function one_date(n){
        var date = new Date('"'+time+'"');
        date = date.valueOf();
        if(n==1){
            var date = date + 24 * 60 * 60 * 1000;
        }else{
            var date = date - 24 * 60 * 60 * 1000;
        }
        var date = new Date(date);
        var month = date.getMonth()+1;

        if(month<10){
            month='0'+month;
        }
        var day = date.getDate();

        if(day<10){
            day='0'+day;
        }
        time =date.getFullYear()+"-" + month + "-" + day;
        $('#time').attr('value',time);
        $('#search-submit').click();
    }

</script>
</html>